#!/usr/bin/env python

import pexpect
import sys
import re

user = sys.argv[1]
domain = user[:-1]
prompt = 'melinda'
ssh = 'ssh {}@{}.labs.overthewire.org'.format(user, domain)

lines = []
with open("/home/spowell/penetration/otw/{}/{}_pass".format(domain, domain), "r") as f:
    for line in f:
        lines.append(line)

line = lines[int(user[-1])]
password = re.search("(\w+)$", line).group(0)

child = pexpect.spawn (ssh)
child.expect ("password: ")
child.sendline (password)
child.expect (prompt)
child.sendline ('alias gdb="gdb -q -ex \'source /usr/local/peda/peda.py\'"')
child.expect (prompt)
child.sendline ('cd /' + domain)
child.expect(prompt)
child.sendline ('clear')
child.expect (prompt)
child.interact()     # Give control of the child to the user.
